import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';

<Meta title="Examples/Grid View/README"/>

# Grid View Examples

This page provides various examples of customizing the GridView component.

<br/>

## Example - Custom toolbar action

This example shows how to add a custom action component into the gridView configuration that rendered in the grid toolbar.

### Steps

Implement custom component that prints "Hello World" underneath the grid.

```jsx
const withGridViewPrintAction = R.curry((WrappedGrid, props) => {
    const {id: gridId, defaultActions = []} = props;

    const [msg, updateMsg] = useState();

    const onRefreshHandler = () => updateMsg("Hello World");

    const _defaultActions = [
        ...defaultActions,
        <Tooltip title="Print" key={`${gridId}-print-action`} role="tooltip">
            <IconButton onClick={onRefreshHandler} role="button" aria-label="Refresh">
                <Print/>
            </IconButton>
        </Tooltip>,
    ];

    return (
        <>
            <WrappedGrid {...props} defaultActions={_defaultActions}/>

            <Typography variant="h1">{msg}</Typography>
        </>
    );
});
```

Implement a custom factory component for the GridView component where we add the custom action into the compose function.

```jsx
const GridViewFactory = (props) => {

    const ComposedGridView = R.compose(
        withGridViewConfigLoader,
        withGridViewDefaultActions,
        withGridViewActionExecutor,
        withCriteriaStateListener(null),
        withGridViewDataLoader,
        withGridViewSorting,
        withGridViewSelection,
        withGridViewPagination,
        withGridViewPrintAction
    )(GridView);

    return (
        <ComposedGridView {...props}/>
    );
};
```

Create mapping conditions for the domain components.

```jsx
const DomainComponentMapping = R.cond([
    [R.propEq('type', 'grid'), GridViewFactory],
]);
```

Implement the domain component factory in the way that the domain component mapping comes first.

```jsx
const DomainComponentFactory = (props) => DomainComponentMapping(props) || DefaultComponentFactory(props)
```

<br/>

## Example - Custom column renderer

This example shows how to customize a Grid View component with adding a custom column rendering logic.

### Steps

Implement function for custom rendering value for a domain specific columns.
In the below snippet Material UI Alert component used as an example.

```jsx
	const renderStatus = R.curry((column, value) => {
		const {name} = column;
		const isCaseStatus = "case_status" === name;
		const severity = R.cond([
			[R.equals("Open"), R.always("info")],
			[R.equals("Error"), R.always("error")],
			[R.equals("Close"), R.always("success")],
			[R.T, R.always("warning")],
		])(value);

		const icon = isCaseStatus ? {icon: false} : {};
		return <Alert variant={isCaseStatus ? "filled" : "outlined"} severity={severity} {...icon}>{value}</Alert>;
	});
```

Implement a custom renderer function.

```jsx
	const domainStatusColumnRenderer = (value, row, column) => renderStatus(column, value);
```

Implement extension (HOC) for the grid that apply the custom renderer for a domain columns.

```jsx
	const withDomainColumnRendering = R.curry((WrappedGrid, props) => {
		const {columns = []} = props;
		const isDomainColumn = R.anyPass([R.propEq('name', 'case_status'), R.propEq('name', 'task_status')]);
		const domainStatusColumnMapper = R.when(isDomainColumn, column => ({
			...column,
			renderer: domainStatusColumnRenderer
		}));
		const _columns = R.map(domainStatusColumnMapper, columns);

		return <WrappedGrid {...props} columns={_columns}/>;
	});
```

Implement a custom factory component for the GridView component where we add withDomainColumnRendering HOC.

```jsx
const GridViewFactory = (props) => {

    const ComposedGridView = R.compose(
        withGridViewConfigLoader,
        withGridViewDefaultActions,
        withGridViewActionExecutor,
        withCriteriaStateListener(null),
        withGridViewDataLoader,
        withGridViewSorting,
        withGridViewSelection,
        withGridViewPagination,
        withDomainColumnRendering
    )(GridView);

    return (
        <ComposedGridView {...props}/>
    );
};
```

Create mapping conditions for the domain components.

```jsx
const DomainComponentMapping = R.cond([
    [R.propEq('type', 'grid'), GridViewFactory],
]);
```

Implement the domain component factory in the way that the domain component mapping comes first.

```jsx
const DomainComponentFactory = (props) => DomainComponentMapping(props) || DefaultComponentFactory(props)
```

<br/>

## Example - Custom column action

This example shows how to customize a Grid View component with adding a custom column action logic.

### Steps

Implement custom column action mapper for gender column.

```jsx
const mappedColumnName = 'gender';
const useColumnActionType = R.cond([[R.propEq('name', mappedColumnName), R.always('download')]]);
```

Create a custom renderer and use it for gender column to indicate custom action.

```jsx
const customActionRenderer = R.curry((column) => {
			return (value, record, column) => {
				const handleClick = (event) => {
					event.preventDefault();
					column.onClick && column.onClick(record);
				};
				return <Tooltip title={column.label} role="tooltip">
					<GetAppIcon cursor='pointer' color="inherit" onClick={handleClick}/>
				</Tooltip>;
			};
		});
const useColumnRenderer = column => R.cond([[R.propEq('name', mappedColumnName), customActionRenderer]])(column) || useDefaultColumnRenderer(column);
```

Implement extension (HOC) for the grid to put changes above together.

```jsx
const withCustomColumnActionType = R.curry((WrappedGrid, props) => {
		return <WrappedGrid {...props} useColumnActionType={useColumnActionType} useColumnRenderer={useColumnRenderer} />;
	});
```

Implement a custom factory component for the GridView component where we add withCustomColumnActionType HOC.

```jsx
	const GridViewFactory = (props) => {
		const ComposedGridView = R.compose(
			withCustomColumnActionType,
			withGridViewConfigLoader,
			withGridViewSettings(defaultGridViewSettings),
			withGridViewDefaultActions,
			withGridViewModelBulkActions,
			withGridViewRowActions,
			withGridViewActionExecutor,
			withGridViewDataLoader,
			withGridViewSorting,
			withGridViewSelection,
			withGridViewPagination,
		)(GridView);

		return (
			<ComposedGridView {...props}/>
		);
	};
```

Create mapping conditions for the domain components.

```jsx
const DomainComponentMapping = R.cond([
    [R.propEq('type', 'grid'), GridViewFactory],
]);
```

Implement the domain component factory in the way that the domain component mapping comes first.

```jsx
const DomainComponentFactory = (props) => DomainComponentMapping(props) || DefaultComponentFactory(props)
```

<br/>

## Example - Row double-click handler

This example shows how to customize a Grid View component with adding a custom row double-click handler.

### Steps

Create custom logic that passes useCustomCellRenderer with implemented view action on any column double-click to GridView props.

```jsx
const findCustomAction = actionName => R.find(R.propEq("name", actionName));
const withUseCustomCellRenderer = R.curry((WrappedGrid, props) => {
	const {id, actions} = props;
	const dispatch = useDispatch();
	const action = findCustomAction('view')(actions);
	const useCustomCellRenderer = R.curry((classes, row, column) => {
		const value = row[column.name];
		return (
			<TableCell onDoubleClick={() => dispatch(grids.updateGridCurrentAction(id, {action, selected: row}))} key={`${row.id}-${column.name}`} className={classes.tableCell} scope="row" variant="body">
				{column.renderer ? column.renderer(value, row, column) : value}
			</TableCell>
		);
	});
	return <WrappedGrid {...props} useCellRenderer={useCustomCellRenderer}/>;
});
```

Implement a custom factory component for the GridView component where we add withUseCustomCellRenderer.

```jsx
const GridViewFactory = (props) => {
		const ComposedGridView = R.compose(
			withGridViewConfigLoader,
			withGridViewSettings(defaultGridViewSettings),
			withGridViewDefaultActions,
			withGridViewModelBulkActions,
			withGridViewActionExecutor,
			withGridViewDataLoader,
			withGridViewSorting,
			withGridViewSelection,
			withGridViewPagination,
			withUseCustomCellRenderer
		)(GridView);
		return (
			<ComposedGridView {...props}/>
		);
	};
```

Create mapping conditions for the domain components.

```jsx
const DomainComponentMapping = R.cond([
    [R.propEq('type', 'grid'), GridViewFactory],
]);
```

Implement the domain component factory in the way that the domain component mapping comes first.

```jsx
const DomainComponentFactory = (props) => DomainComponentMapping(props) || DefaultComponentFactory(props)
```
