import {Meta} from '@storybook/addon-docs/blocks';

<Meta title="Examples/Form Field/README"/>

# Form Field Usage Example

This page provides various examples of using and customizing the Form Field component.

<br/>

## Example - Custom form field adornment

This example shows how to add a custom URL form field adornment that opens the entered url in a new browser tab.

### Steps

Create an extension (HOC) for the URL Field component that adds custom field adornment.
Adornment can be added both to the beginning (`startAdornment`) and to the end (`endAdornment`) of the form field.

```jsx
const withOpenBrowserTabAdornment = R.curry((formId, WrappedField, props) => {

	const {id, value: url, InputProps = {}} = props;

	const formState = useSelector(R.pathOr({}, ["forms", formId, "data"]));

	const invalid = R.defaultTo(false)(R.path([id, "invalid"], formState));

	const onClickHandler = () => {
		window.open(url, "_blank");
	};

	const endAdornment = url && !invalid && (
		<InputAdornment position="end">
			<Tooltip title="Open in a new browser tab" role="tooltip">
				<IconButton size="small"
				            role="button"
				            aria-label="Open"
				            onClick={onClickHandler}>
					<OpenInNewIcon/>
				</IconButton>
			</Tooltip>
		</InputAdornment>
	);

	return <WrappedField {...props} InputProps={{...InputProps, endAdornment}}/>;
});
```

Implement a Factory to build a custom URL Form Field.

```jsx
const UsersUrlFieldFactory = (props) => {
	const {formId} = props;

	return withOpenBrowserTabAdornment(formId, UrlField);
};
```

Create mapping conditions for the domain form fields.

```jsx
const DomainFieldMapper = R.cond([
    [R.propEq("ui", "usersUrl"), UsersUrlFieldFactory],
]);
```

Implement the domain form field factory in the way that the domain form fields mapping comes first.

```jsx
const DomainFormFieldFactory = (props) => DomainFieldMapper(props) || DefaultFormFieldFactory(props);
```


## Example - Custom form field

This example shows how to add a custom form field based on [Material UI Rating component](https://material-ui.com/components/rating/)

### Steps

Implement custom component that shows rating for a given numeric value. The properties below are used by the component:

| prop | Description |
|:----|:-------------------|
| id        |  Comes from field configuration, used as rating component name |
| label     |  Comes from field configuration, used to render FormLabel |
| value     |  Initially comes from configuration as default value, then after any field change new value will be passed via props |
| onChange  |  Typically onChange is a handler responsible for updating the field value in form redux state |


```jsx
const RatingField = props => {

    const {id, label, margin = "dense", value, onChange} = props;

    const handleChange = (event, newValue) => {
        onChange && onChange(newValue);
    };

    return (
        <FormControl margin={margin} fullWidth component="div">
            <FormLabel component="label">{label}</FormLabel>

            <Rating name={id} value={value} onChange={handleChange}/>
        </FormControl>
    );
};
```

Implement a Factory to build a custom Rating Form Field or use default factory for others.

```jsx
    const DomainFormFieldFactory = (props) => R.ifElse(
        R.propEq("ui", "rating"),
        R.always(RatingField),
        DefaultFormFieldFactory
    )(props);
```


## Example - Custom form field formatter

This example shows how to add a custom form field formatter for the following use-case:
User enters the phone number as 1234567898. This needs to be formatted to 123-456-7898.

### Steps

This example uses third-party library [react-text-mask](https://github.com/text-mask/text-mask) to format an input.
Pls note that this library is not currently maintained, so you should probably consider using alternative options.

Add the library as a dependency, for example with yarn:
```jsx
yarn add react-text-mask
```

Implement a MaskedInput component with needed configuration and handle the inputRef property.

```jsx
const TextMaskCustom = props => {
    const {inputRef, mask, guide = false, showMask = true, ...other} = props;

    return <MaskedInput
        {...other}
        ref={(ref) => {
            inputRef(ref ? ref.inputElement : null);
        }}
        mask={mask}
        guide={guide}
        showMask={showMask}
    />;
};
```

Create an extension (HOC) for the Autocomplete Field component that adds custom input component.
Also as an example there is a logic to wipe mask out of the value in handleChange.

```jsx
const withMaskedInput = R.curry((mask, WrappedField, props) => {

    const {onChange, InputProps = {}, inputProps = {}} = props;

    const handleChange = (value) => {
        onChange && onChange(R.replace(/\D+/g, '', R.defaultTo('', value)));
    };

    return <WrappedField {...props}
                         InputProps={{...InputProps, inputComponent: TextMaskCustom}}
                         onChange={handleChange}
                         inputProps={{...inputProps, mask: mask}}/>;
});
```

Create phone field factory and mapping conditions for the domain form fields.

```jsx
const phoneMask = [/\d/, /\d/, /\d/, '-', /\d/, /\d/, /\d/, '-', /\d/, /\d/, /\d/, /\d/];

const PhoneFieldFactory = () => withMaskedInput(phoneMask, AutocompleteField);

const DomainFieldMapper = R.cond([
    [R.propEq("ui", "phone"), PhoneFieldFactory],
]);
```

Implement the domain form field factory in the way that the domain form fields mapping comes first.

```jsx
const DomainFormFieldFactory = (props) => DomainFieldMapper(props) || DefaultFormFieldFactory(props);
```
